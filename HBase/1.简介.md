## HBase简介

![HBase](picture\habse.png)

#### 概述

1. HBASE是Apache提供的基于Hadoop的、分布式的、可扩展的、能够存储大量数据的非关系型数据库
2. 基于Google的论文《BigTable》设计实现
3. 区别于传统数据库的行存储，HBASE是面向列进行存储，底层基于Key-Value结构存储
4. HBASE能够提供低延迟的数据查询能力，其原因是底层充分利用了缓存机制以及复杂的数据结构和算法来实现

#### 行存储和列存储

1. 行存储在磁盘上的存储是连续的；列存储在磁盘上的存储是不连续的
2. 从写入性能上对比，写入次数越少性能越高。因为针对磁盘的每一次写入，都要发生磁头调度，产生寻道时间。因为行存储是只写一次而列存储要写多次，所以行存储在写入性能上更有优势
3. 从读取性能上对比：
   1. 如果读取的是整表，则行存储性能较高
   2. 如果是读取指定的列，则行存储会产生冗余列，而冗余列的消除是在内存中发生。而列存储则不会存在冗余列
4. 在存储数据的时候，如果基于行存储，由于一行数据的字段类型可能不同，所以会产生频繁的数据类型转换；如果是基于列存储，由于同一列数据的类型一般一致，则可以避免频繁的数据类型转换，同时可以考虑一些更好的压缩算法对一列数据进行压缩

#### 特点

1. 分布式架构：HBASE是通过集群来存储数据，数据最终要落地到HDFS上
2. 是一种NoSQL的非关系型数据库，不符合关系型数据库的范式
3. 面向列存储，底层基于key-value结构
4. 适合存储半结构化、非结构化的数据
5. 适合存储稀疏的数据，空的数据不占用空间
6. 提供实时的增删改查的能力，但是不提供严格的事务机制，只能在行级别提供事务

#### 结构

HBase以表的形式存储数据。表有行和列族组成。列族划分为若干个列。其结构如下：

![HBase结构](picture\hbase1.jpg)

#### Row Key：行键

1. hbase本质上也是一种Key-Value存储系统。Key相当于RowKey，Value相当于列族数据的集合

2. 与nosql数据库们一样，row key是用来检索记录的**主键**

3. 访问hbase table中的行，只有三种方式：
   1. 通过单个row      key访问
   2. 通过row key的range
   3. 全表扫描

5. Row key行键 (Row key)可以是任意字符串(最大长度是 64KB，实际应用中长度一般为 10-100bytes)，在hbase内部，row key保存为字节数组

6. 存储时， 数据按照Rowkey的**字典序**(byte order)排序存储。设计key时，要充分排序存储这个特性，将经常一起读取的行存储放到一起。(位置相关性)

#### 列族

1. hbase表中的每个列，都归属与某个列族
2. 列族是表的schema的一部分(而列不是)，列族必须在使用表之前定义
3. 列名都以列族作为前缀。例如courses:history， courses:math 都属于 courses 这个列族
4. 访问控制、磁盘和内存的使用统计都是在列族层面进行的。实际应用中，列族上的控制权限能帮助管理不同类型的应用：允许一些应用可以添加新的基本数据、一些应用可以读取基本数据并创建继承的列族、一些应用则只允许浏览数据（甚至可能因为隐私的原因不能浏览所有数据）

#### Cell与时间戳

1. 由{row key, column( =<family> + < label>), version} 唯一确定的单元

2. cell中的数据是没有类型的，全部是字节码形式存贮

3. 每个cell都保存着同一份数据的多个版本，版本通过时间戳来索引

4. 时间戳的类型是64位整型。时间戳可以由hbase(在数据写入时自动 )赋值，此时时间戳是精确到毫秒的当前系统时间。时间戳也可以由客户显式赋值

5. 如果应用程序要避免数据版本冲突，就必须自己生成具有唯一性的时间戳

6. 每个cell中，不同版本的数据按照时间倒序排序，即最新的数据排在最前面

7. 为了避免数据存在过多版本造成的的管理(包括存贮和索引)负担，hbase提供了两种数据版本回收方式：
   1. 保存数据的最后n个版本
   2. 保存最近一段时间内的版本（比如最近七天）


用户可以针对每个列族进行设置